@bot.slash_command(
    name="rps",
    description="Play Rock-Paper-Scissors",
)
async def rps_command(ctx, opponent: nextcord.User = None):
    rpsGame = ['ğŸ—¿', 'ğŸ§»', 'âœ‚ï¸']

    try:
        if opponent:
            await ctx.send(f"{ctx.user.mention} challenges {opponent.mention} to Rock-Paper-Scissors! {opponent.mention}, please make your choice...")
        else:
            await ctx.send(f"Rock, paper, or scissors? Choose wisely...")

        options = [
            nextcord.ui.Button(label="ğŸ—¿", custom_id="ğŸ—¿"),
            nextcord.ui.Button(label="ğŸ§»", custom_id="ğŸ§»"),
            nextcord.ui.Button(label="âœ‚ï¸", custom_id="âœ‚ï¸")
        ]

        view = nextcord.ui.View()
        for option in options:
            view.add_item(option)

        message = await ctx.send("Please make your choice:", view=view)

        def check(res):
            return res.user == ctx.user and res.message.id == message.id and res.custom_id in rpsGame

        # Now, we'll wait for the button click event
        interaction = await bot.wait_for("button_click", check=check)
        user_choice = interaction.custom_id

        if opponent:
            await ctx.send(f"{opponent.mention}, please make your choice...")

            def opponent_check(res):
                return res.user == opponent and res.message.id == message.id and res.custom_id in rpsGame

            opponent_interaction = await bot.wait_for("button_click", check=opponent_check)
            opponent_choice = opponent_interaction.custom_id
        else:
            comp_choice = random.choice(rpsGame)
            opponent_choice = comp_choice

        # Determine the game result
        if user_choice == opponent_choice:
            result = "It's a tie!"
        elif (
            (user_choice == 'ğŸ—¿' and opponent_choice == 'âœ‚ï¸') or
            (user_choice == 'ğŸ§»' and opponent_choice == 'ğŸ—¿') or
            (user_choice == 'âœ‚ï¸' and opponent_choice == 'ğŸ§»')
        ):
            result = f"{ctx.user.mention} wins against {opponent.mention}!"
        else:
            result = f"{opponent.mention} wins against {ctx.user.mention}!"

        # Send the game result
        await ctx.send(result)
    
    except Exception as e:
        await ctx.send(f"âŒ An error occurred: {str(e)}", ephemeral=True)

# Event handler for button clicks
@bot.event
async def on_button_click(interaction):
    # You can add additional logic here if needed
    await interaction.respond(type=nextcord.InteractionType.DeferredUpdateMessage)
